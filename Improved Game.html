<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Guess the Number ‒ Advanced Game</title>
  <!-- Include js‑confetti library for confetti effect -->
  <script src="https://cdn.jsdelivr.net/npm/js-confetti@latest/dist/js-confetti.browser.js"></script>
  <style>
    :root {
      --bg-light: #f0f4f8;
      --text-light: #333;
      --bg-dark: #1e1e2f;
      --text-dark: #e0e0e0;
      --accent-easy: #28a745;
      --accent-medium: #ffc107;
      --accent-hard: #dc3545;
    }
    [data-theme="dark"] {
      background-color: var(--bg-dark);
      color: var(--text-dark);
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background: var(--bg-light);
      color: var(--text-light);
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      transition: background 0.5s, color 0.5s;
    }
    .container {
      width: 95%;
      max-width: 500px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      padding: 25px 30px;
      position: relative;
      overflow: hidden;
      transition: background 0.5s;
    }
    .container.theme-easy { border-top: 8px solid var(--accent-easy); }
    .container.theme-medium { border-top: 8px solid var(--accent-medium); }
    .container.theme-hard { border-top: 8px solid var(--accent-hard); }

    h1 {
      text-align: center;
      margin-bottom: 20px;
    }
    label, select, input, button {
      width: 100%;
      margin: 10px 0;
      font-size: 1rem;
      padding: 10px;
      border-radius: 4px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      transition: transform 0.2s, background 0.3s, border-color 0.3s;
    }
    button {
      cursor: pointer;
      background-color: #007BFF;
      border: none;
      color: white;
      font-weight: bold;
      transition: background-color 0.3s ease, transform 0.2s ease;
    }
    button:hover:not(:disabled) {
      background-color: #0056b3;
      transform: scale(1.05);
    }
    button:active:not(:disabled) {
      transform: scale(0.98);
    }
    input:disabled, button:disabled {
      background-color: #ddd;
      cursor: not-allowed;
    }

    .message {
      margin-top: 15px;
      padding: 10px;
      border-radius: 4px;
      min-height: 60px;
      opacity: 0;
      transition: opacity 0.5s;
    }
    .message.show {
      opacity: 1;
    }
    .message.hint { background-color: #d9edf7; color: #31708f; }
    .message.success { background-color: #dff0d8; color: #3c763d; }
    .message.error { background-color: #f2dede; color: #a94442; }

    .progress-container {
      margin: 10px 0;
      height: 20px;
      background: #e9ecef;
      border-radius: 10px;
      overflow: hidden;
    }
    .progress-bar {
      height: 100%;
      width: 100%;
      background: #007BFF;
      transition: width 0.5s ease;
    }

    #guesses-list {
      margin-top: 10px;
      font-size: 0.9rem;
    }

    #timer-info {
      font-size: 1.1rem;
      font-weight: bold;
      text-align: center;
      margin-bottom: 10px;
    }

    #toggle-panel {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    #toggle-panel label {
      margin: 0;
      font-size: 0.9rem;
    }

    /* Modal styles */
    #modal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    #modal-content {
      background: white;
      padding: 30px;
      border-radius: 10px;
      text-align: center;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.2);
      animation: fadeInModal 0.4s ease-out;
    }
    @keyframes fadeInModal {
      from { opacity: 0; transform: scale(0.8); }
      to { opacity: 1; transform: scale(1); }
    }
    .modal-button {
      margin: 10px 5px;
      padding: 10px 20px;
      font-size: 1rem;
      border-radius: 5px;
      border: none;
      cursor: pointer;
    }
    .btn-restart { background-color: #28a745; color: white; }
    .btn-newgame { background-color: #17a2b8; color: white; }

    /* Dark theme overrides */
    [data-theme="dark"] .container {
      background: #2a2a3b;
      box-shadow: 0 4px 20px rgba(0,0,0,0.6);
    }
    [data-theme="dark"] button {
      background-color: #1a73e8;
    }
    [data-theme="dark"] button:hover:not(:disabled) {
      background-color: #124cab;
    }
  </style>
</head>
<body data-theme="light">
  <div class="container theme-medium" id="game-container">
    <h1>Guess the Number ‒ Advanced</h1>

    <div id="toggle-panel">
      <div>
        <label for="difficulty">Choose difficulty:</label>
        <select id="difficulty">
          <option value="easy">Easy (1‑50, 10 attempts)</option>
          <option value="medium" selected>Medium (1‑100, 7 attempts)</option>
          <option value="hard">Hard (1‑200, 5 attempts)</option>
        </select>
      </div>
      <div>
        <input type="checkbox" id="theme-toggle" />
        <label for="theme-toggle">Dark Mode</label>
      </div>
    </div>

    <div id="toggle-panel">
      <div>
        <input type="checkbox" id="music-toggle" />
        <label for="music-toggle">Background Music</label>
      </div>
      <div>
        <input type="checkbox" id="sound-toggle" checked />
        <label for="sound-toggle">Sound Effects</label>
      </div>
    </div>

    <button id="start-btn">Start Game</button>

    <div id="game-area" style="display:none;">
      <div id="timer-info">Time left: <span id="timer-display">--</span>s</div>

      <p id="range-info"></p>

      <label for="guess-input">Enter your guess:</label>
      <input type="number" id="guess-input" placeholder="Type a number" />
      <button id="guess-btn">Guess</button>

      <div class="message" id="message"></div>

      <div class="progress-container">
        <div class="progress-bar" id="attempts-bar"></div>
      </div>
      <p id="attempts-info"></p>
      <p id="score-info"></p>

      <div id="guesses-list"></div>
      <p>High Score: <span id="high-score">0</span></p>
      <p>Best Time: <span id="best-time">--</span>s</p>
    </div>
  </div>

  <!-- Modal for end of game -->
  <div id="modal">
    <div id="modal-content">
      <p id="modal-message"></p>
      <button id="restart-btn" class="modal-button btn-restart">Restart Same Game</button>
      <button id="newgame-btn" class="modal-button btn-newgame">New Game (Pick Difficulty)</button>
    </div>
  </div>

  <!-- Audio resources -->
  <audio id="bg-music" src="https://cdn.pixabay.com/audio/2022/ambience-111.mp3" loop></audio>
  <audio id="correct-sound" src="https://cdn.pixabay.com/audio/2021/08/04/audio_15a47dc9f3.mp3"></audio>
  <audio id="wrong-sound" src="https://cdn.pixabay.com/audio/2022/03/15/audio_d6fc79de91.mp3"></audio>
  <script>
    // Confetti
    const jsConfetti = new JSConfetti();

    // Settings
    const difficultySettings = {
      easy: { low: 1, high: 50, maxAttempts: 10, themeClass: 'theme-easy' },
      medium: { low: 1, high: 100, maxAttempts: 7, themeClass: 'theme-medium' },
      hard: { low: 1, high: 200, maxAttempts: 5, themeClass: 'theme-hard' }
    };

    let targetNumber, attempts, maxAttempts, low, high, guesses, timer, timeLeft;
    let gameStarted = false;
    let currentDifficulty = 'medium';
    let highScore = parseInt(localStorage.getItem('highScore')) || 0;
    let bestTime = parseInt(localStorage.getItem('bestTime')) || null;

    // DOM
    const body = document.body;
    const container = document.getElementById('game-container');
    const difficultySelect = document.getElementById('difficulty');
    const themeToggle = document.getElementById('theme-toggle');
    const musicToggle = document.getElementById('music-toggle');
    const soundToggle = document.getElementById('sound-toggle');
    const startBtn = document.getElementById('start-btn');
    const gameArea = document.getElementById('game-area');
    const rangeInfo = document.getElementById('range-info');
    const guessInput = document.getElementById('guess-input');
    const guessBtn = document.getElementById('guess-btn');
    const messageDiv = document.getElementById('message');
    const attemptsInfo = document.getElementById('attempts-info');
    const scoreInfo = document.getElementById('score-info');
    const guessesList = document.getElementById('guesses-list');
    const highScoreSpan = document.getElementById('high-score');
    const bestTimeSpan = document.getElementById('best-time');
    const attemptsBar = document.getElementById('attempts-bar');
    const timerDisplay = document.getElementById('timer-display');
    const modal = document.getElementById('modal');
    const modalMessage = document.getElementById('modal-message');
    const restartBtn = document.getElementById('restart-btn');
    const newgameBtn = document.getElementById('newgame-btn');
    const bgMusic = document.getElementById('bg-music');
    const correctSound = document.getElementById('correct-sound');
    const wrongSound = document.getElementById('wrong-sound');

    // Initialize displays
    highScoreSpan.textContent = highScore;
    bestTimeSpan.textContent = bestTime !== null ? bestTime : '--';

    // Event listeners
    themeToggle.addEventListener('change', () => {
      if (themeToggle.checked) {
        body.setAttribute('data-theme', 'dark');
      } else {
        body.setAttribute('data-theme', 'light');
      }
    });

    startBtn.addEventListener('click', () => {
      currentDifficulty = difficultySelect.value;
      startGame();
    });
    guessBtn.addEventListener('click', makeGuess);
    guessInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') makeGuess();
    });

    restartBtn.addEventListener('click', () => {
      modal.style.display = 'none';
      startGame();  // restart same difficulty
    });
    newgameBtn.addEventListener('click', () => {
      modal.style.display = 'none';
      gameArea.style.display = 'none';
    });

    musicToggle.addEventListener('change', () => {
      if (musicToggle.checked) {
        bgMusic.play();
      } else {
        bgMusic.pause();
        bgMusic.currentTime = 0;
      }
    });

    soundToggle.addEventListener('change', () => {
      // nothing needed, just gating play in code
    });

    function startGame() {
      const settings = difficultySettings[currentDifficulty];
      low = settings.low; high = settings.high; maxAttempts = settings.maxAttempts;
      container.className = 'container ' + settings.themeClass;

      targetNumber = Math.floor(Math.random() * (high - low + 1)) + low;
      attempts = 0; guesses = [];
      gameStarted = true;

      // Timer: e.g. 10 seconds per attempt
      timeLeft = maxAttempts * 10;
      timerDisplay.textContent = timeLeft;
      if (timer) clearInterval(timer);
      timer = setInterval(() => {
        timeLeft--;
        timerDisplay.textContent = timeLeft;
        if (timeLeft <= 0) {
          endGame(false, `⏰ Time’s up! You lost. The number was ${targetNumber}.`);
        }
      }, 1000);

      // UI setup
      rangeInfo.textContent = `Guess a number between ${low} and ${high}`;
      attemptsInfo.textContent = `Attempts left: ${maxAttempts - attempts}`;
      scoreInfo.textContent = '';
      messageDiv.textContent = '';
      messageDiv.className = 'message';
      guessesList.textContent = '';
      guessInput.value = '';
      guessInput.disabled = false;
      guessBtn.disabled = false;
      gameArea.style.display = 'block';
      guessInput.focus();
      updateAttemptsBar();
    }

    function makeGuess() {
      if (!gameStarted) return;
      const guess = Number(guessInput.value);
      if (!guess || guess < low || guess > high) {
        showMessage(`Enter a number between ${low} and ${high}.`, 'error');
        animateShake(messageDiv);
        return;
      }
      attempts++;
      guesses.push(guess);
      guessesList.textContent = 'Previous guesses: ' + guesses.join(', ');
      updateAttemptsBar();

      if (guess === targetNumber) {
        playSound(correctSound);
        // time taken
        let timeTaken = (maxAttempts * 10) - timeLeft;
        let score = maxAttempts - attempts + 1;
        showMessage(`🎉 Correct! You guessed in ${attempts} tries and ${timeTaken}s. Score: ${score}.`, 'success');
        updateHighScore(score, timeTaken);
        jsConfetti.addConfetti();  // confetti effect
        endGame(true);
      } else {
        playSound(wrongSound);
        let hint = guess < targetNumber ? 'Too low!' : 'Too high!';
        showMessage(hint, 'error');
        animateFlash(rangeInfo);
        if (attempts === Math.floor(maxAttempts / 2)) {
          const midHint = guess < targetNumber ? `Try above ${guess}` : `Try below ${guess}`;
          showMessage('Hint: ' + midHint, 'hint');
        }
        attemptsInfo.textContent = `Attempts left: ${maxAttempts - attempts}`;
        if (attempts >= maxAttempts) {
          endGame(false, `You lost! The number was ${targetNumber}.`);
        }
      }
      guessInput.value = '';
      guessInput.focus();
    }

    function showMessage(msg, type) {
      messageDiv.textContent = msg;
      messageDiv.className = `message ${type} show`;
    }

    function endGame(won, overrideMsg) {
      gameStarted = false;
      guessInput.disabled = true;
      guessBtn.disabled = true;
      clearInterval(timer);
      const msg = overrideMsg || (won ? 'You won!' : `You lost! The number was ${targetNumber}.`);
      modalMessage.textContent = msg;
      modal.style.display = 'flex';
    }

    function playSound(audio) {
      if (soundToggle.checked) {
        audio.currentTime = 0;
        audio.play();
      }
    }

    function updateHighScore(score, timeTaken) {
      if (score > highScore || (score === highScore && (bestTime === null || timeTaken < bestTime))) {
        highScore = score;
        bestTime = timeTaken;
        localStorage.setItem('highScore', highScore);
        localStorage.setItem('bestTime', bestTime);
        highScoreSpan.textContent = highScore;
        bestTimeSpan.textContent = bestTime;
      }
    }

    function updateAttemptsBar() {
      const percent = ((maxAttempts - attempts) / maxAttempts) * 100;
      attemptsBar.style.width = percent + '%';
    }

    function animateFlash(elem) {
      elem.classList.add('flash');
      setTimeout(() => elem.classList.remove('flash'), 500);
    }

    function animateShake(elem) {
      elem.classList.add('shake');
      setTimeout(() => elem.classList.remove('shake'), 500);
    }
  </script>
</body>
</html>
